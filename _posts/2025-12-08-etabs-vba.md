---
layout: single
title: "Tự động hóa ETABS: Đọc file .e2k bằng Excel VBA không cần API"
date: 2025-12-08
categories:
  - Automation
  - ETABS
  - Programming
tags:
  - VBA
  - Excel
  - Data Extraction
  - ETABS API
excerpt: "Hướng dẫn kỹ thuật đọc dữ liệu trực tiếp từ file văn bản ETABS (.e2k) bằng Excel VBA. Giải pháp thay thế OAPI giúp tăng tốc độ xử lý và không phụ thuộc vào bản quyền phần mềm."
header:
  overlay_image: /assets/images/hero-engineering.jpg
  overlay_filter: 0.5
  teaser: /assets/images/app-icons/etabs-vba.png
author_profile: true
---

Trong lĩnh vực tự động hóa thiết kế kết cấu (Structural Design Automation), việc trích xuất dữ liệu từ mô hình ETABS là bước khởi đầu quan trọng. Thông thường, các kỹ sư thường sử dụng **ETABS OAPI (Open Application Programming Interface)**. Tuy nhiên, OAPI tồn tại một số rào cản nhất định: phải khởi động phần mềm (gây chậm), yêu cầu máy tính phải có License hợp lệ, và quy trình khai báo đối tượng COM phức tạp.

Bài viết này giới thiệu một phương pháp tiếp cận khác hiệu quả hơn: **Đọc trực tiếp cấu trúc file văn bản .e2k bằng Excel VBA**, dựa trên nghiên cứu chuyên sâu từ chuyên gia **Vivek Patel (Nodes Automations)**.

## 1. Bản chất của file .e2k và .$et

File `.e2k` (hoặc `.$et`) thực chất là các tệp văn bản thuần túy (Plain Text) chứa toàn bộ thông tin định nghĩa mô hình. Cấu trúc của chúng được tổ chức thành các khối (Block) dữ liệu rất rõ ràng.

Ví dụ về khối định nghĩa tầng (Stories):
```text
$ STORIES - IN SEQUENCE FROM TOP
  STORY="Story4" HEIGHT=3000 MASTERSTORY="Yes" SIMILARTO="None" SPLICEABOVE="No" ...
  STORY="Story3" HEIGHT=3000 MASTERSTORY="No" SIMILARTO="Story4" SPLICEABOVE="No" ...

Nhờ cấu trúc dạng KEYWORD="Value", chúng ta hoàn toàn có thể sử dụng các thuật toán xử lý chuỗi (String Manipulation) trong VBA để trích xuất dữ liệu mà không cần "đụng" đến phần mềm ETABS.
2. Quy trình trích xuất dữ liệu (Workflow)
Minh họa quy trình trích xuất dữ liệu (Nguồn: Vivek Patel)
Giải pháp này bao gồm các bước chính sau:
Bước 1: Thiết lập môi trường VBA
Trong Excel, mở trình soạn thảo VBA (Alt + F11). Bạn không cần thêm Reference ETABSv1.dll. Tuy nhiên, để thao tác với file text dễ dàng, nên bật thư viện Microsoft Scripting Runtime.
Bước 2: Đọc file bằng FileSystemObject (FSO)
Sử dụng FileSystemObject để mở file .e2k và đọc tuần tự từng dòng (Line-by-line reading). Cách này tốn rất ít tài nguyên hệ thống.
' Code snippet minh họa việc mở file
Dim fso As New FileSystemObject
Dim txtStream As TextStream
Dim strLine As String

Set txtStream = fso.OpenTextFile(FilePath, ForReading)

Do While Not txtStream.AtEndOfStream
    strLine = txtStream.ReadLine
    ' Gọi hàm xử lý dữ liệu tại đây
Loop

Bước 3: Thuật toán Parsing (Phân tích cú pháp)
Mấu chốt của phương pháp nằm ở việc xác định điểm bắt đầu và điểm kết thúc của khối dữ liệu cần lấy.
 * Tìm Block: Dùng hàm InStr để tìm dòng chứa tiêu đề khối, ví dụ: SECTION PROPERTIES - CONCRETE - RECTANGULAR.
 * Duyệt phần tử: Khi đã vào trong khối, tiếp tục đọc các dòng tiếp theo.
 * Tách dữ liệu: Viết các hàm tiện ích (ExtractString, ExtractNumber) để lấy giá trị sau các từ khóa như MAT=, DEPTH=, WIDTH=.
Bước 4: Xử lý chuỗi nâng cao
Dữ liệu trong file .e2k thường nằm trong dấu ngoặc kép hoặc không. Cần xây dựng hàm xử lý linh hoạt:
 * Nếu là chuỗi (String): Loại bỏ dấu "".
 * Nếu là số (Double): Chuyển đổi định dạng văn bản sang số học để tính toán.
3. Ưu điểm và Ứng dụng thực tế
Phương pháp này mang lại lợi thế vượt trội so với API truyền thống trong các trường hợp:
 * Tốc độ: Xử lý file text nhanh hơn gấp nhiều lần so với việc chờ ETABS khởi động và load mô hình.
 * Generate Model Summary: Tạo bảng tổng hợp nhanh về tiết diện, vật liệu, chiều cao tầng để rà soát (Check-list) trước khi chạy nội lực.
 * Validation: Kiểm tra lỗi nhập liệu của con người (Human errors) như tên tầng sai quy tắc, vật liệu gán nhầm.
 * Không cần License: Có thể chạy tool trên bất kỳ máy nào có Excel, kể cả máy không cài ETABS.
4. Tài liệu tham khảo
Đây là kỹ thuật nâng cao đòi hỏi kiến thức tốt về xử lý chuỗi trong lập trình. Để xem hướng dẫn chi tiết từng bước và code mẫu hoàn chỉnh, các bạn hãy tham khảo bài viết gốc của tác giả:
 * Blog Post: How to Read ETABS (*.e2k) Files Using Excel VBA - Nodes Automations
 * LinkedIn Discussion: Vivek Patel's Post
<!-- end list -->

