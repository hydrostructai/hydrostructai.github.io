<html lang="vi"><head>
  <meta charset="UTF-8">
  <title>Google Chart + Editable Table (CSV I/O, Unicode, Save-As)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body{
      font-family: "Segoe UI", Tahoma, Arial, "Helvetica Neue", Helvetica, system-ui, -apple-system, Roboto, sans-serif;
      margin:16px;background:#fafafa
    }
    h1{font-size:18px;margin:8px 0 12px}
    .panel{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:16px;box-shadow:0 1px 4px rgba(0,0,0,.04);max-width:1100px;margin:0 auto}
    #chart_div{width:100%;height:480px;margin:0 auto 12px}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin:12px auto 0;max-width:1100px}
    button{appearance:none;border:1px solid #e5e7eb;background:#111827;color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600}
    button.secondary{background:#fff;color:#111827}
    button:hover{opacity:.9}
    #table_wrap{position:relative}
    .row-controls{position:absolute;top:50%;right:-46px;transform:translateY(-50%);display:none;flex-direction:column;gap:6px}
    .col-controls-below{display:none;justify-content:center;gap:6px;margin-top:8px}
    .pill{border:1px solid #e5e7eb;background:#fff;color:#111827;border-radius:999px;padding:6px 10px;font-weight:700}
    .title-row{display:flex;align-items:center;gap:8px;margin:6px 0 10px}
    .title-row label{color:#6b7280;font-size:12px}
    .title-row input{flex:1;max-width:520px;border:1px solid #e5e7eb;border-radius:8px;padding:8px 10px}
    table{border-collapse:collapse;width:100%;background:#fff}
    th,td{border:1px solid #e5e7eb;padding:8px 10px;text-align:center}
    th{background:#f3f4f6;font-weight:700}
    tr:nth-child(even) td{background:#fcfcfd}
    .edit-on td.editable{outline:none !important; box-shadow:none !important; background:#fff}
    .note{text-align:center;color:#6b7280;margin-top:6px;font-size:12px}
    input[type="file"]{display:none}
    .info-frame {
        display: grid;
        grid-template-columns: auto minmax(0, 1fr) auto minmax(0, 1fr);
        gap: 8px 12px;
        align-items: center;
        margin-bottom: 16px;
        padding: 16px;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        background-color: #f9fafb;
    }
    .info-frame label {
        font-weight: 600;
        color: #374151;
    }
    .info-frame input {
        border: 1px solid #d1d5db;
        border-radius: 6px;
        padding: 6px 10px;
        width: 100%;
        box-sizing: border-box;
    }
    .assessor-row {
        grid-column: 1 / -1;
        display: flex;
        align-items: center;
        gap: 12px;
    }
    .assessor-row input {
        flex: 1;
    }
    footer {
        text-align: center;
        margin-top: 24px;
        padding: 16px 0;
        font-size: 12px;
        color: #6b7280;
    }
    .chart-title{
      text-align:center;
      margin:0 0 8px;
      font-size:18px;
      text-transform:uppercase; /* giữ nguyên kiểu CHỮ IN như hiện tại */
    }
  </style>

  <script type="text/javascript">
    // ===================================================================
    // == CONFIG & INITIALIZATION
    // ===================================================================
    const initialDataArray = [
  [
    "Ngày khám",
    "Nhận thức trước lời",
    "Ngôn ngữ diễn đạt",
    "Ngôn ngữ cảm nhận",
    "Vận động tinh",
    "Vận động thô",
    "Liên kết tay mắt",
    "Diễn đạt cảm xúc",
    "Tương tác xã hội",
    "Tự chăm sóc bản thân",
    "Tháng tuổi"
  ],
  [
    "12/01/2025",
    27,
    25,
    26,
    27,
    30,
    28,
    34,
    29,
    30,
    58
  ],
  [
    "15/02/2025",
    29,
    28,
    29,
    30,
    33,
    29,
    34,
    30,
    33,
    59
  ],
  [
    "20/05/2025",
    32,
    28,
    34,
    35,
    35,
    30,
    35,
    31,
    33,
    62
  ],
  [
    "22/07/2025",
    33,
    33,
    36,
    38,
    42,
    31,
    35,
    32,
    37,
    64
  ],
  [
    "15/08/2025",
    36,
    33,
    40,
    45,
    42,
    33,
    36,
    33,
    37,
    65
  ]
];

    let chart, dataTable, options;
    let isEditing = false;

    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(init);

    function init(){
      document.getElementById('title_input').value = "Thang đánh giá phát triển tâm lý";
      document.getElementById('chart_title').textContent = document.getElementById('title_input').value;
      buildTableFromArray(initialDataArray);
      drawFromArray(initialDataArray);
      window.addEventListener('resize', ()=> chart.draw(dataTable, options));
    }

    // ===================================================================
    // == DATE & AGE CALCULATION HELPERS
    // ===================================================================
    function parseDate(dateString) {
        if (!dateString) return null;
        const parts = dateString.match(/(\d+)/g);
        if (!parts || parts.length < 3) return null;
        const day = parseInt(parts[0], 10);
        const month = parseInt(parts[1], 10) - 1;
        let year = parseInt(parts[2], 10);
        if (year < 100) year += 2000;
        const date = new Date(year, month, day);
        if (date.getFullYear() === year && date.getMonth() === month && date.getDate() === day) {
            return date;
        }
        return null;
    }

    function calculateMonthsDifference(startDate, endDate) {
        if (!startDate || !endDate || isNaN(startDate.getTime()) || isNaN(endDate.getTime())) return null;
        if (endDate < startDate) return 0;
        let months = (endDate.getFullYear() - startDate.getFullYear()) * 12;
        months -= startDate.getMonth();
        months += endDate.getMonth();
        if (endDate.getDate() < startDate.getDate()) {
            months--;
        }
        return months <= 0 ? 0 : months;
    }

    // ===================================================================
    // == CORE CHART & DATA LOGIC
    // ===================================================================
    function computeAgeInMonths(arr) {
        const out = arr.map(r => r.slice());
        const dobString = document.getElementById('patient_dob').value;
        const dob = parseDate(dobString);
        const ageColIdx = out[0].length - 1;
        out[0][ageColIdx] = 'Tháng tuổi';
        if (dob) {
            for (let i = 1; i < out.length; i++) {
                const examDateString = out[i][0];
                const examDate = parseDate(examDateString);
                out[i][ageColIdx] = calculateMonthsDifference(dob, examDate);
            }
        } else {
            for (let i = 1; i < out.length; i++) {
                out[i][ageColIdx] = null;
            }
        }
        return out;
    }

    function drawFromArray(arr){
      const arrWithAge = computeAgeInMonths(arr);
      
      dataTable = new google.visualization.DataTable();
      if (arrWithAge.length > 0 && arrWithAge[0].length > 0) {
          dataTable.addColumn('string', arrWithAge[0][0]);
          for (let i = 1; i < arrWithAge[0].length; i++) {
              dataTable.addColumn('number', arrWithAge[0][i]);
          }
          if (arrWithAge.length > 1) {
              dataTable.addRows(arrWithAge.slice(1));
          }
      } else {
          chart = new google.visualization.ComboChart(document.getElementById('chart_div'));
          chart.draw(google.visualization.arrayToDataTable([['', ''],['', 0]]), {});
          return;
      }

      const ageSeriesIndex = arrWithAge[0].length - 2;

      options = {
        title: '',
        vAxis:{title:'Đơn vị: Tháng'},
        hAxis:{title: arrWithAge[0][0] || 'Category'},
        seriesType:'bars',
        series:{
            [ageSeriesIndex]: {
                type: 'steppedArea',
                color: '#4285F4', // Blue color
                lineWidth: 3,
                areaOpacity: 0 // Hide the area fill
            }
        },
        legend: { position: 'top', maxLines: 5 },
        chartArea:{left:60,right:20,top:60,bottom:60}
      };
      chart = new google.visualization.ComboChart(document.getElementById('chart_div'));
      chart.draw(dataTable, options);
    }

    function refreshChart(){
      const arr = readTableToArray();
      drawFromArray(arr);

      // == CODE ĐÃ SỬA THEO YÊU CẦU ==
      // Sau khi làm mới biểu đồ, tự động thoát chế độ chỉnh sửa.
      // Thao tác này sẽ ẩn các nút điều khiển hàng/cột và đặt bảng thành chỉ đọc.
      isEditing = false;
      syncEditState();
      // == KẾT THÚC PHẦN CODE ĐÃ SỬA ==
    }

    function onTitleInput(){
      if(!chart) return;
      const t = document.getElementById('title_input').value || 'Chart';
      document.getElementById('chart_title').textContent = t;
      options.title = ''; // đảm bảo chart không vẽ title
      chart.draw(dataTable, options);
    }

    // ===================================================================
    // == EDITABLE TABLE MANAGEMENT
    // ===================================================================
    function buildTableFromArray(arr){
      const table = document.getElementById('data_table');
      table.innerHTML = '';
      const thead = document.createElement('thead');
      const headerRow = document.createElement('tr');
      arr[0].forEach((h, idx)=>{
        const th = document.createElement('th');
        th.textContent = h;
        if(idx === arr[0].length-1){ th.setAttribute('data-lock','1'); }
        headerRow.appendChild(th);
      });
      thead.appendChild(headerRow);
      table.appendChild(thead);

      const tbody = document.createElement('tbody');
      for(let i=1;i<arr.length;i++){
        const tr = document.createElement('tr');
        for(let j=0;j<arr[i].length;j++){
          const td = document.createElement('td');
          td.textContent = arr[i][j] === null ? '' : arr[i][j];
          if(j === arr[i].length-1){
            td.setAttribute('data-lock','1');
          } else {
            td.classList.add('editable');
          }
          tr.appendChild(td);
        }
        tbody.appendChild(tr);
      }
      table.appendChild(tbody);
      syncEditState();
    }

    function readTableToArray(){
      const table = document.getElementById('data_table');
      const arr = [];
      const headers = Array.from(table.querySelectorAll('thead th')).map(th => th.textContent.trim());
      arr.push(headers);
      const rows = table.querySelectorAll('tbody tr');
      rows.forEach(tr=>{
        const row=[];
        tr.querySelectorAll('td').forEach((td, idx)=>{
          if(idx===0) row.push(td.textContent.trim());
          else{
            const v = Number(td.textContent.replace(/,/g,''));
            row.push(isNaN(v)? null : v);
          }
        });
        arr.push(row);
      });
      return computeAgeInMonths(arr);
    }

    function syncEditState(){
      const table = document.getElementById('data_table');
      table.classList.toggle('edit-on', isEditing);
      const allCells = table.querySelectorAll('th, td');
      allCells.forEach(cell=>{
        const locked = cell.getAttribute('data-lock')==='1';
        cell.contentEditable = (isEditing && !locked) ? 'true' : 'false';
      });
      document.getElementById('row_controls').style.display = isEditing ? 'flex':'none';
      document.getElementById('col_controls').style.display = isEditing ? 'flex':'none';
      document.getElementById('title_input').disabled = !isEditing;
    }

    function toggleEdit(){
      isEditing = !isEditing;
      syncEditState();
    }

    // ===================================================================
    // == ROW & COLUMN CONTROLS
    // ===================================================================
    function addColumnBeforeAverage(){
      const arr = readTableToArray();
      const insertIdx = arr[0].length - 1;
      const seriesName = prompt('Nhập tên cột mới:', 'New Series') || 'New Series';
      for(let i=0;i<arr.length;i++){
        if(i===0) arr[i].splice(insertIdx,0, seriesName);
        else arr[i].splice(insertIdx,0, 0);
      }
      buildTableFromArray(arr);
      drawFromArray(arr);
    }
    function removeLastSeriesBeforeAverage(){
      const arr = readTableToArray();
      if(arr[0].length <= 3){ alert('Cần tối thiểu 1 cột dữ liệu + Tháng tuổi.'); return; }
      const removeIdx = arr[0].length - 2;
      if(removeIdx<=1){ alert('Không còn cột dữ liệu nào để xóa.'); return; }
      for(let i=0;i<arr.length;i++){ arr[i].splice(removeIdx,1); }
      buildTableFromArray(arr);
      drawFromArray(arr);
    }

    function addRowAtBottom(){
      const arr = readTableToArray();
      const cols = arr[0].length;
      const newLabel = prompt('Nhập nhãn dòng mới:', `New ${arr.length}`) || `New ${arr.length}`;
      const row = Array(cols).fill(0);
      row[0] = newLabel;
      arr.push(row);
      buildTableFromArray(arr);
      drawFromArray(arr);
    }
    function removeLastRow(){
      const arr = readTableToArray();
      if(arr.length<=2){ alert('Cần tối thiểu 1 dòng dữ liệu.'); return; }
      arr.splice(arr.length-1,1);
      buildTableFromArray(arr);
      drawFromArray(arr);
    }

    // ===================================================================
    // == CSV IMPORT / EXPORT
    // ===================================================================
    function importCSVTrigger(){
      document.getElementById('csv_file_input').click();
    }

    async function handleCSVFileChange(e){
        const file = e.target.files && e.target.files[0];
        if (!file) return;
        try {
            const text = await readFileAsTextSmart(file);
            let allRows = parseCSV(text);
            if (!allRows.length) { alert('CSV không hợp lệ.'); return; }

            const infoHeaders = {
                'Họ và tên': 'patient_name',
                'Ngày sinh': 'patient_dob',
                'Ngày khám': 'exam_date',
                'Người đánh giá': 'assessor_name',
                '#CHART_TITLE': 'title_input'
            };

            let dataRowStartIndex = 0;
            for (let i = 0; i < allRows.length; i++) {
                const row = allRows[i];
                const key = row[0]?.trim();

                // A row is metadata if its key is known AND it has 2 or fewer columns.
                // This prevents the multi-column data header from being misidentified.
                if (infoHeaders[key] && row.length <= 2) {
                    const value = row[1]?.trim() || '';
                    const el = document.getElementById(infoHeaders[key]);
                    if (el) el.value = value;
                    dataRowStartIndex = i + 1;
                } else {
                    // If it's not a metadata row, we've reached the data section.
                    break;
                }
            }

            // Skip any empty lines between metadata and the data table
            while (dataRowStartIndex < allRows.length && (!allRows[dataRowStartIndex].length || allRows[dataRowStartIndex].every(c => c.trim() === ''))) {
                dataRowStartIndex++;
            }

            let arr = allRows.slice(dataRowStartIndex);
            if (!arr.length || arr[0].length < 2) {
                alert('Thiếu hàng tiêu đề cột trong CSV.'); return;
            }

            for (let i = 1; i < arr.length; i++) {
                for (let j = 1; j < arr[i].length; j++) {
                    if (j === arr[0].length - 1) continue; // Skip age column
                    const num = Number(String(arr[i][j]).replace(/,/g, ''));
                    arr[i][j] = isNaN(num) ? null : num;
                }
            }

            buildTableFromArray(arr);
            drawFromArray(arr);
            onTitleInput();
            e.target.value = '';
        } catch (err) {
            console.error(err);
            alert('Không thể đọc CSV: ' + (err.message || err));
        }
    }

    async function saveCSV(){
      const infoHeaders = {
          'patient_name': 'Họ và tên',
          'patient_dob': 'Ngày sinh',
          'exam_date': 'Ngày khám',
          'assessor_name': 'Người đánh giá'
      };
      const infoToSave = Object.keys(infoHeaders).map(id => {
          return [infoHeaders[id], document.getElementById(id).value];
      });
      const title = document.getElementById('title_input').value || '';
      infoToSave.push(['#CHART_TITLE', title]);
      const arr = readTableToArray();
      const csv = arrayToCSV([...infoToSave, ...arr]);
      const blob = new Blob(["\uFEFF", csv], {type:'text/csv;charset=utf-8'});
      await saveWithPicker('data.csv', 'text/csv', blob);
    }

    function arrayToCSV(arr){
      const escape = (val)=>{
        if(val===null || val===undefined) return '';
        const s = String(val);
        if(/[",\n]/.test(s)){
          return '"' + s.replace(/"/g,'""') + '"';
        }
        return s;
      };
      return arr.map(row=>row.map(escape).join(',')).join('\n');
    }

    function parseCSV(text){
      const rows=[]; let row=[]; let i=0; const n=text.length;
      let val=''; let inQuotes=false;
      while(i<n){
        const ch=text[i];
        if(inQuotes){
          if(ch==='\"'){
            if(i+1<n && text[i+1]==='\"'){ val+='\"'; i++; }
            else { inQuotes=false; }
          } else { val+=ch; }
        } else {
          if(ch==='\"'){ inQuotes=true; }
          else if(ch===','){ row.push(val); val=''; }
          else if(ch==='\n' || ch==='\r'){
            if(ch==='\r' && i+1<n && text[i+1]==='\n') i++;
            row.push(val); rows.push(row); row=[]; val='';
          } else { val+=ch; }
        }
        i++;
      }
      row.push(val); rows.push(row);
      if(rows.length && rows[rows.length-1].length===1 && rows[rows.length-1][0]===''){
        rows.pop();
      }
      return rows;
    }

    async function readFileAsTextSmart(file){
      const buf = await file.arrayBuffer();
      const bytes = new Uint8Array(buf);
      if(bytes.length>=3 && bytes[0]===0xEF && bytes[1]===0xBB && bytes[2]===0xBF){
        return new TextDecoder('utf-8').decode(bytes.subarray(3));
      }
      if(bytes.length>=2 && bytes[0]===0xFF && bytes[1]===0xFE){
        return new TextDecoder('utf-16le').decode(bytes.subarray(2));
      }
      if(bytes.length>=2 && bytes[0]===0xFE && bytes[1]===0xFF){
        return new TextDecoder('utf-16be').decode(bytes.subarray(2));
      }
      return new TextDecoder('utf-8').decode(bytes);
    }

    // ===================================================================
    // == FILE SAVE & EXPORT HELPERS
    // ===================================================================
    function saveDataHTML(){
        const arr = readTableToArray();
        const escapedData = JSON.stringify(arr, null, 2);
        const currentTitle = document.getElementById('title_input').value;
        const escapedTitle = JSON.stringify(currentTitle);

        const infoInputs = ['patient_name', 'patient_dob', 'exam_date', 'assessor_name'];
        infoInputs.forEach(id => {
            const el = document.getElementById(id);
            if (el) el.setAttribute('value', el.value);
        });

        let html = document.documentElement.outerHTML;

        infoInputs.forEach(id => {
            const el = document.getElementById(id);
            if (el) el.removeAttribute('value');
        });

        html = html.replace(
            /const\s+initialDataArray\s*=\s*\[[\s\S]*?\];/, 
            'const initialDataArray = ' + escapedData + ';'
        );

        html = html.replace(
            /(document\.getElementById\('title_input'\)\.value\s*=\s*)".*?";/,
            `$1${escapedTitle};`
        );

        const blob = new Blob([html], {type:'text/html;charset=utf-8'});
        saveWithPicker('GOOGLE-CHART.html', 'text/html', blob);
    }

    async function captureAndSaveJPG(areaElement, filename) {
        const inputs = areaElement.querySelectorAll('input[type="text"]');
        const tempElements = [];

        inputs.forEach(input => {
            const div = document.createElement('div');
            div.textContent = input.value;
            const style = window.getComputedStyle(input);
            div.style.cssText = `
                width: ${style.width}; height: auto; min-height: ${style.height};
                padding: ${style.padding}; border: ${style.border}; border-radius: ${style.borderRadius};
                background-color: ${style.backgroundColor}; font: ${style.font};
                line-height: ${style.lineHeight}; box-sizing: border-box; text-align: left;
                white-space: pre-wrap; word-break: break-word;
            `;
            input.style.display = 'none';
            input.parentNode.insertBefore(div, input);
            tempElements.push({ input, div });
        });

        try {
            const canvas = await html2canvas(areaElement, { backgroundColor: '#ffffff', scale: 2 });
            const jpgDataUrl = canvas.toDataURL('image/jpeg', 0.95);
            const blob = dataURLToBlob(jpgDataUrl);
            await saveWithPicker(filename, 'image/jpeg', blob);
        } finally {
            tempElements.forEach(({ input, div }) => {
                input.style.display = '';
                div.remove();
            });
        }
    }

    async function saveChartJPG() {
        // == CODE ĐÃ SỬA THEO YÊU CẦU ==
        // Nếu đang ở chế độ chỉnh sửa, thoát ra để ẩn các nút điều khiển trước khi chụp ảnh.
        if (isEditing) {
            isEditing = false;
            syncEditState();
        }
        // == KẾT THÚC PHẦN CODE ĐÃ SỬA ==
        const area = document.getElementById('chart_export_area');
        await captureAndSaveJPG(area, 'chart.jpg');
    }

    async function saveFigTableJPG() {
        // == CODE ĐÃ SỬA THEO YÊU CẦU ==
        // Nếu đang ở chế độ chỉnh sửa, thoát ra để ẩn các nút điều khiển trước khi chụp ảnh.
        if (isEditing) {
            isEditing = false;
            syncEditState();
        }
        // == KẾT THÚC PHẦN CODE ĐÃ SỬA ==
        const note = document.querySelector('.note');
        const originalDisplay = note.style.display;
        note.style.display = 'none';
        const area = document.getElementById('export_area');
        try {
            await captureAndSaveJPG(area, 'chart_table.jpg');
        } finally {
            note.style.display = originalDisplay;
        }
    }

    async function savePDF() {
        // == CODE ĐÃ SỬA THEO YÊU CẦU ==
        // Nếu đang ở chế độ chỉnh sửa, thoát ra để ẩn các nút điều khiển trước khi tạo PDF.
        if (isEditing) {
            isEditing = false;
            syncEditState();
        }
        // == KẾT THÚC PHẦN CODE ĐÃ SỬA ==
        if (typeof window.jspdf === 'undefined') {
            alert('Lỗi: Thư viện tạo file PDF chưa sẵn sàng. Vui lòng kiểm tra kết nối mạng và thử lại.');
            console.error('The "jspdf" global object is not defined.');
            return;
        }
        const { jsPDF } = window.jspdf;

        const note = document.querySelector('.note');
        const originalNoteDisplay = note.style.display;
        note.style.display = 'none';
        const areaElement = document.getElementById('export_area');

        const inputs = areaElement.querySelectorAll('input[type="text"]');
        const tempElements = [];
        inputs.forEach(input => {
            const div = document.createElement('div');
            div.textContent = input.value;
            const style = window.getComputedStyle(input);
            div.style.cssText = `
                width: ${style.width}; height: auto; min-height: ${style.height};
                padding: ${style.padding}; border: ${style.border}; border-radius: ${style.borderRadius};
                background-color: ${style.backgroundColor}; font: ${style.font};
                line-height: ${style.lineHeight}; box-sizing: border-box; text-align: left;
                white-space: pre-wrap; word-break: break-word;
            `;
            input.style.display = 'none';
            input.parentNode.insertBefore(div, input);
            tempElements.push({ input, div });
        });

        try {
            // A slightly lower scale and using JPEG will significantly reduce file size.
            const canvas = await html2canvas(areaElement, { backgroundColor: '#ffffff', scale: 1.5 });
            const imgData = canvas.toDataURL('image/jpeg', 0.9); // Use JPEG with 90% quality
            const canvasWidth = canvas.width;
            const canvasHeight = canvas.height;

            const orientation = canvasWidth > canvasHeight ? 'l' : 'p';
            const pdf = new jsPDF(orientation, 'pt', 'a4');
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const pdfHeight = pdf.internal.pageSize.getHeight();
            
            const ratio = Math.min(pdfWidth / canvasWidth, pdfHeight / canvasHeight);
            
            const imgX = (pdfWidth - canvasWidth * ratio) / 2;
            const imgY = (pdfHeight - canvasHeight * ratio) / 2;

            pdf.addImage(imgData, 'JPEG', imgX, imgY, canvasWidth * ratio, canvasHeight * ratio);
            
            const pdfBlob = pdf.output('blob');
            await saveWithPicker('chart_and_table.pdf', 'application/pdf', pdfBlob);

        } catch (err) {
            console.error("Error creating PDF:", err);
            alert("Could not create PDF file. See console for details.");
        } finally {
            tempElements.forEach(({ input, div }) => {
                input.style.display = '';
                div.remove();
            });
            note.style.display = originalNoteDisplay;
        }
    }

    async function saveWithPicker(suggestedName, mime, blob){
      try{
        if('showSaveFilePicker' in window){
          const handle = await window.showSaveFilePicker({
            suggestedName,
            types:[{ description: mime, accept: { [mime]: [suggestedName.slice(suggestedName.lastIndexOf('.'))] } }]
          });
          const writable = await handle.createWritable();
          await writable.write(blob);
          await writable.close();
          return;
        }
      }catch(err){
        console.warn('Save picker error / cancelled:', err);
      }
      const name = prompt('Nhập tên file để lưu:', suggestedName) || suggestedName;
      const a=document.createElement('a');
      const url=URL.createObjectURL(blob);
      a.href=url; a.download=name; document.body.appendChild(a); a.click();
      setTimeout(()=>{URL.revokeObjectURL(url); a.remove();},0);
    }

    function dataURLToBlob(dataURL){
      const parts = dataURL.split(',');
      const mime = parts[0].match(/:(.*?);/)[1];
      const bstr = atob(parts[1]);
      let n = bstr.length;
      const u8 = new Uint8Array(n);
      while(n--){ u8[n] = bstr.charCodeAt(n); }
      return new Blob([u8], {type:mime});
    }
  </script><script type="text/javascript" charset="UTF-8" src="https://www.gstatic.com/charts/51/loader.js"></script>
<link id="load-css-0" rel="stylesheet" type="text/css" href="https://www.gstatic.com/charts/51/css/core/tooltip.css"><link id="load-css-1" rel="stylesheet" type="text/css" href="https://www.gstatic.com/charts/51/css/util/util.css"><script type="text/javascript" charset="UTF-8" src="https://www.gstatic.com/charts/51/js/jsapi_compiled_default_module.js"></script><script type="text/javascript" charset="UTF-8" src="https://www.gstatic.com/charts/51/js/jsapi_compiled_graphics_module.js"></script><script type="text/javascript" charset="UTF-8" src="https://www.gstatic.com/charts/51/js/jsapi_compiled_ui_module.js"></script><script type="text/javascript" charset="UTF-8" src="https://www.gstatic.com/charts/51/js/jsapi_compiled_corechart_module.js"></script></head>
<body>
  <div class="title-row">
    <label>Tiêu đề biểu đồ:</label>
    <input id="title_input" type="text" oninput="onTitleInput()" disabled="">
  </div>

  <div id="export_area" class="panel">
    <div id="chart_export_area">
      <div class="info-frame">
        <label for="patient_name">Họ và tên:</label>
        <input type="text" id="patient_name" style="" value="Trần Văn Biên">
        <label for="patient_dob">Ngày sinh:</label>
        <input type="text" id="patient_dob" placeholder="dd/mm/yyyy" style="" value="5/3/2020">
        
        <label for="exam_date">Ngày khám:</label>
        <input type="text" id="exam_date" placeholder="dd/mm/yyyy" style="" value="22/7/2025">
        
        <div class="assessor-row">
          <label for="assessor_name">Người đánh giá:</label>
          <input type="text" id="assessor_name" style="" value="Ths. Đồng Thị Phượng">
        </div>
      </div>
      <h1 id="chart_title" class="chart-title">Thang đánh giá phát triển tâm lý</h1>
      <div id="chart_div"><div style="position: relative;"><div dir="ltr" style="position: relative; width: 1100px; height: 480px;"><div aria-label="A chart." style="position: absolute; left: 0px; top: 0px; width: 100%; height: 100%;"><svg width="1100" height="480" aria-label="A chart." style="overflow: hidden;"><defs id="_ABSTRACT_RENDERER_ID_13"><clipPath id="_ABSTRACT_RENDERER_ID_14"><rect x="60" y="60" width="1020" height="360"></rect></clipPath></defs><rect x="0" y="0" width="1100" height="480" stroke="none" stroke-width="0" fill="#ffffff"></rect><g><rect x="60" y="14" width="1016" height="38" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></rect><g><rect x="60" y="14" width="167" height="15" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></rect><g><text text-anchor="start" x="96" y="26.75" font-family="Arial" font-size="15" stroke="none" stroke-width="0" fill="#222222">Nhận thức trước lời</text></g><rect x="60" y="14" width="30" height="15" stroke="none" stroke-width="0" fill="#3366cc"></rect></g><g><rect x="251" y="14" width="160" height="15" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></rect><g><text text-anchor="start" x="287" y="26.75" font-family="Arial" font-size="15" stroke="none" stroke-width="0" fill="#222222">Ngôn ngữ diễn đạt</text></g><rect x="251" y="14" width="30" height="15" stroke="none" stroke-width="0" fill="#dc3912"></rect></g><g><rect x="435" y="14" width="173" height="15" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></rect><g><text text-anchor="start" x="471" y="26.75" font-family="Arial" font-size="15" stroke="none" stroke-width="0" fill="#222222">Ngôn ngữ cảm nhận</text></g><rect x="435" y="14" width="30" height="15" stroke="none" stroke-width="0" fill="#ff9900"></rect></g><g><rect x="632" y="14" width="129" height="15" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></rect><g><text text-anchor="start" x="668" y="26.75" font-family="Arial" font-size="15" stroke="none" stroke-width="0" fill="#222222">Vận động tinh</text></g><rect x="632" y="14" width="30" height="15" stroke="none" stroke-width="0" fill="#109618"></rect></g><g><rect x="785" y="14" width="125" height="15" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></rect><g><text text-anchor="start" x="821" y="26.75" font-family="Arial" font-size="15" stroke="none" stroke-width="0" fill="#222222">Vận động thô</text></g><rect x="785" y="14" width="30" height="15" stroke="none" stroke-width="0" fill="#990099"></rect></g><g><rect x="934" y="14" width="142" height="15" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></rect><g><text text-anchor="start" x="970" y="26.75" font-family="Arial" font-size="15" stroke="none" stroke-width="0" fill="#222222">Liên kết tay mắt</text></g><rect x="934" y="14" width="30" height="15" stroke="none" stroke-width="0" fill="#0099c6"></rect></g><g><rect x="60" y="37" width="152" height="15" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></rect><g><text text-anchor="start" x="96" y="49.75" font-family="Arial" font-size="15" stroke="none" stroke-width="0" fill="#222222">Diễn đạt cảm xúc</text></g><rect x="60" y="37" width="30" height="15" stroke="none" stroke-width="0" fill="#dd4477"></rect></g><g><rect x="236" y="37" width="150" height="15" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></rect><g><text text-anchor="start" x="272" y="49.75" font-family="Arial" font-size="15" stroke="none" stroke-width="0" fill="#222222">Tương tác xã hội</text></g><rect x="236" y="37" width="30" height="15" stroke="none" stroke-width="0" fill="#66aa00"></rect></g><g><rect x="410" y="37" width="186" height="15" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></rect><g><text text-anchor="start" x="446" y="49.75" font-family="Arial" font-size="15" stroke="none" stroke-width="0" fill="#222222">Tự chăm sóc bản thân</text></g><rect x="410" y="37" width="30" height="15" stroke="none" stroke-width="0" fill="#b82e2e"></rect></g><g><rect x="620" y="37" width="107" height="15" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></rect><g><text text-anchor="start" x="656" y="49.75" font-family="Arial" font-size="15" stroke="none" stroke-width="0" fill="#222222">Tháng tuổi</text></g><rect x="620" y="37" width="30" height="15" stroke="none" stroke-width="0" fill="#4285f4"></rect></g></g><g><rect x="60" y="60" width="1020" height="360" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></rect><g clip-path="url(file:///C:/Users/Admin/dyad-apps/G/GOOGLE-CHART-COLUMN.html#_ABSTRACT_RENDERER_ID_14)"><g><rect x="60" y="419" width="1020" height="1" stroke="none" stroke-width="0" fill="#cccccc"></rect><rect x="60" y="368" width="1020" height="1" stroke="none" stroke-width="0" fill="#cccccc"></rect><rect x="60" y="316" width="1020" height="1" stroke="none" stroke-width="0" fill="#cccccc"></rect><rect x="60" y="265" width="1020" height="1" stroke="none" stroke-width="0" fill="#cccccc"></rect><rect x="60" y="214" width="1020" height="1" stroke="none" stroke-width="0" fill="#cccccc"></rect><rect x="60" y="163" width="1020" height="1" stroke="none" stroke-width="0" fill="#cccccc"></rect><rect x="60" y="111" width="1020" height="1" stroke="none" stroke-width="0" fill="#cccccc"></rect><rect x="60" y="60" width="1020" height="1" stroke="none" stroke-width="0" fill="#cccccc"></rect><rect x="60" y="393" width="1020" height="1" stroke="none" stroke-width="0" fill="#ebebeb"></rect><rect x="60" y="342" width="1020" height="1" stroke="none" stroke-width="0" fill="#ebebeb"></rect><rect x="60" y="291" width="1020" height="1" stroke="none" stroke-width="0" fill="#ebebeb"></rect><rect x="60" y="240" width="1020" height="1" stroke="none" stroke-width="0" fill="#ebebeb"></rect><rect x="60" y="188" width="1020" height="1" stroke="none" stroke-width="0" fill="#ebebeb"></rect><rect x="60" y="137" width="1020" height="1" stroke="none" stroke-width="0" fill="#ebebeb"></rect><rect x="60" y="86" width="1020" height="1" stroke="none" stroke-width="0" fill="#ebebeb"></rect></g><g><g><rect x="60" y="122.04285714285714" width="204" height="297.45714285714286" stroke="none" stroke-width="0" fill-opacity="0" fill="#4285f4"></rect><path d="M60,122.04285714285714L264,122.04285714285714" stroke="#4285f4" stroke-width="3" fill-opacity="1" fill="none"></path></g><g><rect x="264" y="116.91428571428571" width="204" height="302.5857142857143" stroke="none" stroke-width="0" fill-opacity="0" fill="#4285f4"></rect><path d="M264,122.04285714285714L264,116.91428571428571L468,116.91428571428571" stroke="#4285f4" stroke-width="3" fill-opacity="1" fill="none"></path></g><g><rect x="468" y="101.52857142857141" width="203" height="317.9714285714286" stroke="none" stroke-width="0" fill-opacity="0" fill="#4285f4"></rect><path d="M468,116.91428571428571L468,101.52857142857141L671,101.52857142857141" stroke="#4285f4" stroke-width="3" fill-opacity="1" fill="none"></path></g><g><rect x="671" y="91.27142857142854" width="204" height="328.22857142857146" stroke="none" stroke-width="0" fill-opacity="0" fill="#4285f4"></rect><path d="M671,101.52857142857141L671,91.27142857142854L875,91.27142857142854" stroke="#4285f4" stroke-width="3" fill-opacity="1" fill="none"></path></g><g><rect x="875" y="86.14285714285711" width="204" height="333.3571428571429" stroke="none" stroke-width="0" fill-opacity="0" fill="#4285f4"></rect><path d="M875,91.27142857142854L875,86.14285714285711L1079,86.14285714285711" stroke="#4285f4" stroke-width="3" fill-opacity="1" fill="none"></path></g></g><g><rect x="99" y="282" width="14" height="137" stroke="none" stroke-width="0" fill="#3366cc"></rect><rect x="303" y="271" width="13" height="148" stroke="none" stroke-width="0" fill="#3366cc"></rect><rect x="507" y="256" width="13" height="163" stroke="none" stroke-width="0" fill="#3366cc"></rect><rect x="711" y="251" width="13" height="168" stroke="none" stroke-width="0" fill="#3366cc"></rect><rect x="915" y="235" width="13" height="184" stroke="none" stroke-width="0" fill="#3366cc"></rect><rect x="114" y="292" width="13" height="127" stroke="none" stroke-width="0" fill="#dc3912"></rect><rect x="317" y="276" width="13" height="143" stroke="none" stroke-width="0" fill="#dc3912"></rect><rect x="521" y="276" width="13" height="143" stroke="none" stroke-width="0" fill="#dc3912"></rect><rect x="725" y="251" width="13" height="168" stroke="none" stroke-width="0" fill="#dc3912"></rect><rect x="929" y="251" width="13" height="168" stroke="none" stroke-width="0" fill="#dc3912"></rect><rect x="128" y="287" width="13" height="132" stroke="none" stroke-width="0" fill="#ff9900"></rect><rect x="331" y="271" width="14" height="148" stroke="none" stroke-width="0" fill="#ff9900"></rect><rect x="535" y="246" width="13" height="173" stroke="none" stroke-width="0" fill="#ff9900"></rect><rect x="739" y="235" width="13" height="184" stroke="none" stroke-width="0" fill="#ff9900"></rect><rect x="943" y="215" width="13" height="204" stroke="none" stroke-width="0" fill="#ff9900"></rect><rect x="142" y="282" width="13" height="137" stroke="none" stroke-width="0" fill="#109618"></rect><rect x="346" y="266" width="13" height="153" stroke="none" stroke-width="0" fill="#109618"></rect><rect x="549" y="240" width="13" height="179" stroke="none" stroke-width="0" fill="#109618"></rect><rect x="753" y="225" width="13" height="194" stroke="none" stroke-width="0" fill="#109618"></rect><rect x="957" y="189" width="13" height="230" stroke="none" stroke-width="0" fill="#109618"></rect><rect x="156" y="266" width="13" height="153" stroke="none" stroke-width="0" fill="#990099"></rect><rect x="360" y="251" width="13" height="168" stroke="none" stroke-width="0" fill="#990099"></rect><rect x="563" y="240" width="14" height="179" stroke="none" stroke-width="0" fill="#990099"></rect><rect x="767" y="205" width="13" height="214" stroke="none" stroke-width="0" fill="#990099"></rect><rect x="971" y="205" width="13" height="214" stroke="none" stroke-width="0" fill="#990099"></rect><rect x="170" y="276" width="13" height="143" stroke="none" stroke-width="0" fill="#0099c6"></rect><rect x="374" y="271" width="13" height="148" stroke="none" stroke-width="0" fill="#0099c6"></rect><rect x="578" y="266" width="13" height="153" stroke="none" stroke-width="0" fill="#0099c6"></rect><rect x="781" y="261" width="13" height="158" stroke="none" stroke-width="0" fill="#0099c6"></rect><rect x="985" y="251" width="13" height="168" stroke="none" stroke-width="0" fill="#0099c6"></rect><rect x="184" y="246" width="13" height="173" stroke="none" stroke-width="0" fill="#dd4477"></rect><rect x="388" y="246" width="13" height="173" stroke="none" stroke-width="0" fill="#dd4477"></rect><rect x="592" y="240" width="13" height="179" stroke="none" stroke-width="0" fill="#dd4477"></rect><rect x="795" y="240" width="14" height="179" stroke="none" stroke-width="0" fill="#dd4477"></rect><rect x="999" y="235" width="13" height="184" stroke="none" stroke-width="0" fill="#dd4477"></rect><rect x="198" y="271" width="13" height="148" stroke="none" stroke-width="0" fill="#66aa00"></rect><rect x="402" y="266" width="13" height="153" stroke="none" stroke-width="0" fill="#66aa00"></rect><rect x="606" y="261" width="13" height="158" stroke="none" stroke-width="0" fill="#66aa00"></rect><rect x="810" y="256" width="13" height="163" stroke="none" stroke-width="0" fill="#66aa00"></rect><rect x="1013" y="251" width="13" height="168" stroke="none" stroke-width="0" fill="#66aa00"></rect><rect x="212" y="266" width="13" height="153" stroke="none" stroke-width="0" fill="#b82e2e"></rect><rect x="416" y="251" width="13" height="168" stroke="none" stroke-width="0" fill="#b82e2e"></rect><rect x="620" y="251" width="13" height="168" stroke="none" stroke-width="0" fill="#b82e2e"></rect><rect x="824" y="230" width="13" height="189" stroke="none" stroke-width="0" fill="#b82e2e"></rect><rect x="1027" y="230" width="14" height="189" stroke="none" stroke-width="0" fill="#b82e2e"></rect></g><g><rect x="60" y="419" width="1020" height="1" stroke="none" stroke-width="0" fill="#333333"></rect></g></g><g></g><g><g><text text-anchor="middle" x="162.4" y="441.75" font-family="Arial" font-size="15" stroke="none" stroke-width="0" fill="#222222">12/01/2025</text></g><g><text text-anchor="middle" x="366.20000000000005" y="441.75" font-family="Arial" font-size="15" stroke="none" stroke-width="0" fill="#222222">15/02/2025</text></g><g><text text-anchor="middle" x="570" y="441.75" font-family="Arial" font-size="15" stroke="none" stroke-width="0" fill="#222222">20/05/2025</text></g><g><text text-anchor="middle" x="773.8000000000001" y="441.75" font-family="Arial" font-size="15" stroke="none" stroke-width="0" fill="#222222">22/07/2025</text></g><g><text text-anchor="middle" x="977.6" y="441.75" font-family="Arial" font-size="15" stroke="none" stroke-width="0" fill="#222222">15/08/2025</text></g><g><text text-anchor="end" x="50.666666666666664" y="424.75" font-family="Arial" font-size="15" stroke="none" stroke-width="0" fill="#444444">0</text></g><g><text text-anchor="end" x="50.666666666666664" y="373.4643" font-family="Arial" font-size="15" stroke="none" stroke-width="0" fill="#444444">10</text></g><g><text text-anchor="end" x="50.666666666666664" y="322.1786" font-family="Arial" font-size="15" stroke="none" stroke-width="0" fill="#444444">20</text></g><g><text text-anchor="end" x="50.666666666666664" y="270.8929" font-family="Arial" font-size="15" stroke="none" stroke-width="0" fill="#444444">30</text></g><g><text text-anchor="end" x="50.666666666666664" y="219.6071" font-family="Arial" font-size="15" stroke="none" stroke-width="0" fill="#444444">40</text></g><g><text text-anchor="end" x="50.666666666666664" y="168.3214" font-family="Arial" font-size="15" stroke="none" stroke-width="0" fill="#444444">50</text></g><g><text text-anchor="end" x="50.666666666666664" y="117.0357" font-family="Arial" font-size="15" stroke="none" stroke-width="0" fill="#444444">60</text></g><g><text text-anchor="end" x="50.666666666666664" y="65.75" font-family="Arial" font-size="15" stroke="none" stroke-width="0" fill="#444444">70</text></g></g></g><g><g><text text-anchor="middle" x="570" y="467.25" font-family="Arial" font-size="15" font-style="italic" stroke="none" stroke-width="0" fill="#222222">Ngày khám</text><rect x="60" y="454.5" width="1020" height="15" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></rect></g><g><text text-anchor="middle" x="22.083333333333332" y="240" font-family="Arial" font-size="15" font-style="italic" transform="rotate(-90 22.083333333333332 240)" stroke="none" stroke-width="0" fill="#222222">Đơn vị: Tháng</text><path d="M9.333333333333321,420L9.333333333333343,60L24.333333333333343,60L24.33333333333332,420Z" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></path></g></g><g></g></svg><div aria-label="A tabular representation of the data in the chart." style="position: absolute; left: -10000px; top: auto; width: 1px; height: 1px; overflow: hidden;"><table><thead><tr><th>Ngày khám</th><th>Nhận thức trước lời</th><th>Ngôn ngữ diễn đạt</th><th>Ngôn ngữ cảm nhận</th><th>Vận động tinh</th><th>Vận động thô</th><th>Liên kết tay mắt</th><th>Diễn đạt cảm xúc</th><th>Tương tác xã hội</th><th>Tự chăm sóc bản thân</th><th>Tháng tuổi</th></tr></thead><tbody><tr><td>12/01/2025</td><td>27</td><td>25</td><td>26</td><td>27</td><td>30</td><td>28</td><td>34</td><td>29</td><td>30</td><td>58</td></tr><tr><td>15/02/2025</td><td>29</td><td>28</td><td>29</td><td>30</td><td>33</td><td>29</td><td>34</td><td>30</td><td>33</td><td>59</td></tr><tr><td>20/05/2025</td><td>32</td><td>28</td><td>34</td><td>35</td><td>35</td><td>30</td><td>35</td><td>31</td><td>33</td><td>62</td></tr><tr><td>22/07/2025</td><td>33</td><td>33</td><td>36</td><td>38</td><td>42</td><td>31</td><td>35</td><td>32</td><td>37</td><td>64</td></tr><tr><td>15/08/2025</td><td>36</td><td>33</td><td>40</td><td>45</td><td>42</td><td>33</td><td>36</td><td>33</td><td>37</td><td>65</td></tr></tbody></table></div></div></div><div aria-hidden="true" style="display: none; position: absolute; top: 490px; left: 1110px; white-space: nowrap; font-family: Arial; font-size: 15px;">Tháng tuổi</div><div></div></div></div>
    </div>

    <div id="table_wrap">
      <div id="row_controls" class="row-controls" style="display: none;">
        <button class="pill" title="Thêm dòng xuống dưới cùng" onclick="addRowAtBottom()">+ dòng</button>
        <button class="pill" title="Xóa dòng dưới cùng" onclick="removeLastRow()">− dòng</button>
      </div>
      <table id="data_table" class=""><thead><tr><th contenteditable="false">Ngày khám</th><th contenteditable="false">Nhận thức trước lời</th><th contenteditable="false">Ngôn ngữ diễn đạt</th><th contenteditable="false">Ngôn ngữ cảm nhận</th><th contenteditable="false">Vận động tinh</th><th contenteditable="false">Vận động thô</th><th contenteditable="false">Liên kết tay mắt</th><th contenteditable="false">Diễn đạt cảm xúc</th><th contenteditable="false">Tương tác xã hội</th><th contenteditable="false">Tự chăm sóc bản thân</th><th data-lock="1" contenteditable="false">Tháng tuổi</th></tr></thead><tbody><tr><td class="editable" contenteditable="false">12/01/2025</td><td class="editable" contenteditable="false">27</td><td class="editable" contenteditable="false">25</td><td class="editable" contenteditable="false">26</td><td class="editable" contenteditable="false">27</td><td class="editable" contenteditable="false">30</td><td class="editable" contenteditable="false">28</td><td class="editable" contenteditable="false">34</td><td class="editable" contenteditable="false">29</td><td class="editable" contenteditable="false">30</td><td data-lock="1" contenteditable="false">58</td></tr><tr><td class="editable" contenteditable="false">15/02/2025</td><td class="editable" contenteditable="false">29</td><td class="editable" contenteditable="false">28</td><td class="editable" contenteditable="false">29</td><td class="editable" contenteditable="false">30</td><td class="editable" contenteditable="false">33</td><td class="editable" contenteditable="false">29</td><td class="editable" contenteditable="false">34</td><td class="editable" contenteditable="false">30</td><td class="editable" contenteditable="false">33</td><td data-lock="1" contenteditable="false">59</td></tr><tr><td class="editable" contenteditable="false">20/05/2025</td><td class="editable" contenteditable="false">32</td><td class="editable" contenteditable="false">28</td><td class="editable" contenteditable="false">34</td><td class="editable" contenteditable="false">35</td><td class="editable" contenteditable="false">35</td><td class="editable" contenteditable="false">30</td><td class="editable" contenteditable="false">35</td><td class="editable" contenteditable="false">31</td><td class="editable" contenteditable="false">33</td><td data-lock="1" contenteditable="false">62</td></tr><tr><td class="editable" contenteditable="false">22/07/2025</td><td class="editable" contenteditable="false">33</td><td class="editable" contenteditable="false">33</td><td class="editable" contenteditable="false">36</td><td class="editable" contenteditable="false">38</td><td class="editable" contenteditable="false">42</td><td class="editable" contenteditable="false">31</td><td class="editable" contenteditable="false">35</td><td class="editable" contenteditable="false">32</td><td class="editable" contenteditable="false">37</td><td data-lock="1" contenteditable="false">64</td></tr><tr><td class="editable" contenteditable="false">15/08/2025</td><td class="editable" contenteditable="false">36</td><td class="editable" contenteditable="false">33</td><td class="editable" contenteditable="false">40</td><td class="editable" contenteditable="false">45</td><td class="editable" contenteditable="false">42</td><td class="editable" contenteditable="false">33</td><td class="editable" contenteditable="false">36</td><td class="editable" contenteditable="false">33</td><td class="editable" contenteditable="false">37</td><td data-lock="1" contenteditable="false">65</td></tr></tbody></table>
      <div id="col_controls" class="col-controls-below" style="display: none;">
        <button class="pill" title="Thêm cột trước Tháng tuổi" onclick="addColumnBeforeAverage()">+ cột</button>
        <button class="pill" title="Xóa cột cuối (trước Tháng tuổi)" onclick="removeLastSeriesBeforeAverage()">− cột</button>
      </div>
    </div>

    <div class="note" style="">Bấm <b>EDIT</b> để bật chỉnh sửa. Nút +/− cột được căn giữa ngay phía dưới bảng; +/− dòng nằm giữa bên phải bảng.</div>
  </div>

  <div class="toolbar">
    <button onclick="toggleEdit()">EDIT</button>
    <button class="secondary" onclick="refreshChart()">REFRESH</button>
    <button onclick="saveDataHTML()">SAVE DATA</button>
    <button onclick="saveChartJPG()">SAVE CHART</button>
    <button onclick="saveFigTableJPG()">SAVE FIG TABLE</button>
    <button onclick="savePDF()">SAVE PDF</button>
    <button class="secondary" onclick="importCSVTrigger()">IMPORT CSV</button>
    <button onclick="saveCSV()">SAVE CSV</button>
    <input id="csv_file_input" type="file" accept=".csv,text/csv" onchange="handleCSVFileChange(event)">
  </div>

  <footer>
    © 2025 HHa. All Rights Reserved.
  </footer>

</body></html>